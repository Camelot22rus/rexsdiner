"use strict";(self.webpackChunkreact_pizza_v2=self.webpackChunkreact_pizza_v2||[]).push([[539],{2703:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var n=t(3857),o=t(4309),i=t(7094),l=t(1648),a=t(5940),c=t(8743),r=t(2041),d=t(16),m=t(1180),p=t(3183),u=t(1410),h=t(2455),x=t(9520),v=t(668),j=t(8286),y=t(4270),g=t(4453);const f=e=>{let{isOpen:s,onClose:t}=e;const[o,i]=(0,n.useState)([]),[l,a]=(0,n.useState)({}),[c,r]=(0,n.useState)(!1),[d,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{s&&(r(!0),m(null),fetch("".concat(y.J,"/inventory")).then(e=>e.json()).then(e=>{"success"===e.status?(i(e.data),a({})):m(e.message||"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044f")}).catch(()=>m("\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044f")).finally(()=>r(!1)))},[s]);const p=Object.keys(l).some(e=>{var s;const t=null===(s=o.find(s=>s.name===e))||void 0===s?void 0:s.quantity;return void 0!==t&&l[e]!==t});return s?(0,g.jsx)("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,g.jsxs)("div",{className:"modal",style:{background:"var(--surface-color, #fff)",borderRadius:16,maxWidth:400,width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 40px rgba(0,0,0,0.2)",border:"1px solid var(--border-color, #eee)",padding:24,position:"relative"},children:[(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20},children:[(0,g.jsx)("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:600},children:"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440\u044c"}),(0,g.jsx)("button",{onClick:t,style:{background:"none",border:"none",fontSize:24,cursor:"pointer",color:"var(--text-secondary, #888)"},children:"\xd7"})]}),c?(0,g.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."}):d?(0,g.jsx)("div",{style:{color:"red",marginBottom:16},children:d}):(0,g.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t()},children:[(0,g.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:o.map(e=>{const s=void 0!==l[e.name]?l[e.name]:e.quantity,t=s!==e.quantity;return(0,g.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,g.jsx)("span",{style:{flex:1},children:e.name}),(0,g.jsx)("button",{type:"button",onClick:()=>(e=>{var s;const t=void 0!==l[e]?l[e]:(null===(s=o.find(s=>s.name===e))||void 0===s?void 0:s.quantity)||0;a(s=>(0,j.A)((0,j.A)({},s),{},{[e]:Math.max(0,t-1)}))})(e.name),style:{padding:"4px 10px",borderRadius:6,border:"1px solid var(--border-color, #eee)",background:"#f5f5f5",cursor:"pointer",fontSize:18,fontWeight:700},children:"-"}),(0,g.jsx)("input",{type:"number",value:s,onChange:s=>((e,s)=>{a(t=>(0,j.A)((0,j.A)({},t),{},{[e]:Number(s)}))})(e.name,s.target.value),style:{width:60,padding:6,borderRadius:6,border:"1px solid var(--border-color, #eee)",textAlign:"center",background:t?"#22dace":"white",transition:"background 0.2s"}}),(0,g.jsx)("button",{type:"button",onClick:()=>(e=>{var s;const t=void 0!==l[e]?l[e]:(null===(s=o.find(s=>s.name===e))||void 0===s?void 0:s.quantity)||0;a(s=>(0,j.A)((0,j.A)({},s),{},{[e]:t+1}))})(e.name),style:{padding:"4px 10px",borderRadius:6,border:"1px solid var(--border-color, #eee)",background:"#f5f5f5",cursor:"pointer",fontSize:18,fontWeight:700},children:"+"}),e.unit&&(0,g.jsx)("span",{children:e.unit})]},e.name)})}),(0,g.jsx)("button",{type:"submit",disabled:!p,style:{marginTop:24,width:"100%",background:p?"var(--accent-color, #fe5f1e)":"#ccc",color:"#fff",border:"none",borderRadius:8,padding:"12px 0",fontSize:16,fontWeight:600,cursor:p?"pointer":"not-allowed",opacity:p?1:.7},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})]})]})}):null},b=()=>{const e=(0,o.wA)(),s=(0,x.j)(),{items:t,status:j}=((0,i.Zp)(),(0,o.d4)(l.x)),{totalPrice:y,items:b}=(0,o.d4)(a.V),N=(0,o.d4)(c.J2),_=(0,o.d4)(r.Kc),C=(0,o.d4)(r.mB),[k,w]=n.useState(""),[S,A]=n.useState(!0),[z,B]=n.useState(""),[H,W]=n.useState(!1),[L,M]=n.useState(!1),[P,V]=n.useState(""),[q,I]=n.useState(!1),R=b.reduce((e,s)=>e+s.count,0);n.useEffect(()=>{(async()=>{await s((0,d.Tu)()),M(!0)})()},[s]);const E=Math.round(.3*y*100)/100,O=Math.round(.7*y*100)/100;n.useEffect(()=>{(async()=>{s((0,h.ys)({sortBy:"id",order:"asc",category:"",search:"",currentPage:"1"}))})()},[s]);const Z=t.filter(e=>e.name&&e.name.toLowerCase().includes(k.toLowerCase())),$=Z.reduce((e,s)=>{var t;const n=null!==(t=s.categorie)&&void 0!==t?t:"\u0411\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438";return e[n]||(e[n]=[]),e[n].push(s),e},{}),U=[],D=new Set;for(const n of Z){var J;const e=null!==(J=n.categorie)&&void 0!==J?J:"\u0411\u0435\u0437 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438";D.has(e)||(D.add(e),U.push(e))}return L&&!_?(0,g.jsx)("div",{className:"employee-page",children:(0,g.jsxs)("div",{className:"employee-auth-prompt",children:[(0,g.jsx)("h2",{children:"Employee Access Required"}),(0,g.jsx)("p",{children:"Please log in to access the employee panel."}),(0,g.jsx)(v.zC,{isOpen:L&&!_,onClose:()=>{}})]})}):L?(0,g.jsxs)("div",{className:"employee-page",children:[(0,g.jsxs)("div",{className:"",children:[(0,g.jsxs)("div",{className:"employee-header",children:[(0,g.jsxs)("div",{className:"employee-header__top",children:[(0,g.jsx)("h2",{className:"employee-title",children:"\u041f\u0430\u043d\u0435\u043b\u044c \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430"}),C&&(0,g.jsxs)("div",{className:"employee-user-info",children:[(0,g.jsxs)("span",{className:"employee-username",children:["\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c, ",C.name," (",C.role,")"]}),(0,g.jsx)("button",{className:"employee-logout-btn",onClick:()=>{s((0,d.y4)())},children:"\u0412\u044b\u0439\u0442\u0438"})]})]}),(0,g.jsxs)("div",{className:"employee-header__controls",children:[(0,g.jsx)("div",{className:"employee-search",children:(0,g.jsx)("input",{type:"text",placeholder:"\u041f\u043e\u0438\u0441\u043a \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u043e\u0432...",value:k,onChange:e=>w(e.target.value),className:"employee-search__input"})}),"Admin"===(null===C||void 0===C?void 0:C.role)&&(0,g.jsx)("button",{className:"employee-fridge-btn",style:{display:"flex",alignItems:"center",justifyContent:"center"},title:"Fridge (Admin only)",onClick:()=>I(!0),children:(0,g.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,g.jsx)("rect",{x:"6",y:"3",width:"12",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,g.jsx)("line",{x1:"6",y1:"10",x2:"18",y2:"10",stroke:"currentColor",strokeWidth:"2"}),(0,g.jsx)("circle",{cx:"8.5",cy:"7",r:"1",fill:"currentColor"}),(0,g.jsx)("circle",{cx:"8.5",cy:"14",r:"1",fill:"currentColor"})]})}),(0,g.jsxs)("button",{className:"employee-orders-btn",onClick:()=>e((0,p.B)()),children:[(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)("path",{d:"M9 11H15M9 15H15M17 21H7C5.89543 21 5 20.1046 5 19V5C5 3.89543 5.89543 3 7 3H12.5858C12.851 3 13.1054 3.10536 13.2929 3.29289L19.7071 9.70711C19.8946 9.89464 20 10.149 20 10.4142V19C20 20.1046 19.1046 21 18 21H17ZM17 21V11H13V7H7V19H17Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,g.jsx)("span",{children:"\u0417\u0430\u043a\u0430\u0437\u044b"})]})]})]}),(0,g.jsx)("div",{className:"employee-content",children:(0,g.jsx)("div",{className:"product-list",children:"loading"===j?(0,g.jsx)("div",{className:"loading",children:"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u044b..."}):U.map(s=>(0,g.jsxs)("div",{className:"category-section",children:[(0,g.jsx)("h3",{className:"category-title",children:s}),(0,g.jsx)("div",{className:"category-items",children:$[s].map(s=>{const t=(e=>{const s=b.find(s=>s.id===e);return s?s.count:0})(s.id);return(0,g.jsxs)("div",{className:"product-item",children:[(0,g.jsxs)("div",{className:"product-item__info",children:[(0,g.jsx)("h4",{className:"product-item__title",children:s.name}),(0,g.jsxs)("span",{className:"product-item__price",children:[s.price," $"]})]}),(0,g.jsxs)("div",{className:"product-item__controls",children:[t>0&&(0,g.jsx)("button",{className:"product-item__minus",onClick:()=>(s=>{const t=b.find(e=>e.id===s);t&&1===t.count?e((0,m.Ai)(s)):e((0,m.G8)(s))})(s.id),children:"\u2212"}),t>0&&(0,g.jsx)("span",{className:"product-item__count",children:t}),(0,g.jsx)("button",{className:"product-item__add",onClick:()=>(s=>{const t={id:s.id,title:s.name,price:s.price,imageUrl:s.imageUrl,count:0};e((0,m.B5)(t))})(s),children:"+"})]})]},s.id)})})]},s))})})]}),(0,g.jsxs)("div",{className:"employee-bottom-bar ".concat(S?"collapsed":""),style:{},children:[(0,g.jsx)("button",{className:"employee-toggle-btn",onClick:()=>{A(!S)},"aria-label":S?"Expand bottom bar":"Collapse bottom bar",children:(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"toggle-icon ".concat(S?"collapsed":""),children:(0,g.jsx)("path",{d:"M18 15l-6-6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,g.jsxs)("div",{className:"employee-bottom-content",children:[(0,g.jsx)("div",{className:"employee-total",children:(0,g.jsxs)("div",{className:"employee-total__main",children:[(0,g.jsxs)("span",{className:"employee-total__count",children:[R," \u043f\u043e\u0437\u0438\u0446\u0438\u0439"]}),(0,g.jsxs)("span",{className:"employee-total__price",children:[y," $"]})]})}),b.filter(e=>e.count>0).length>0&&(0,g.jsxs)("div",{className:"employee-cart-list",children:[(0,g.jsx)("h4",{className:"cart-list__title",children:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u0442\u043e\u0432\u0430\u0440\u044b:"}),(0,g.jsx)("div",{className:"cart-list__items",children:b.filter(e=>e.count>0).map(e=>{var s;const n=t.find(s=>s.id===e.id),o=(null===n||void 0===n?void 0:n.comboComponents)&&n.comboComponents.length>0;return(0,g.jsxs)("div",{className:"cart-list__item",children:[(0,g.jsxs)("div",{className:"cart-item__header",children:[(0,g.jsx)("span",{className:"cart-item__name",children:e.title}),(0,g.jsxs)("div",{className:"cart-item__details",children:[(0,g.jsxs)("span",{className:"cart-item__count",children:[e.count,"x"]}),(0,g.jsxs)("span",{className:"cart-item__price",children:[e.price*e.count," $"]})]})]}),o&&(0,g.jsxs)("div",{className:"cart-item__combo-components",children:[(0,g.jsx)("span",{className:"combo-components__label",children:"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442:"}),(0,g.jsx)("div",{className:"combo-components__list",children:null===(s=n.comboComponents)||void 0===s?void 0:s.map(e=>(0,g.jsx)("span",{className:"combo-component",children:e},e))})]})]},e.id)})})]}),(0,g.jsx)("div",{className:"employee-notes",children:(0,g.jsx)("input",{type:"text",placeholder:"\u0417\u0430\u043c\u0435\u0442\u043a\u0438 \u043a \u0437\u0430\u043a\u0430\u0437\u0443...",value:P,onChange:e=>V(e.target.value),className:"employee-notes__input"})}),(0,g.jsx)("button",{className:"employee-complete-btn ".concat(0===R?"disabled":""),onClick:async()=>{if(R>0){const n={items:b.filter(e=>e.count>0),totalPrice:y,totalCount:R,thirtyPercent:E,seventyPercent:O,userId:null===C||void 0===C?void 0:C.id,notes:P};try{const t=await s((0,u.fS)(n));if(u.fS.fulfilled.match(t)){const s=t.payload;B("\u0417\u0430\u043a\u0430\u0437 #".concat(s.id," \u043d\u0430 \u0441\u0443\u043c\u043c\u0443 ").concat(s.totalPrice," $ (").concat(s.totalCount," \u043f\u043e\u0437\u0438\u0446\u0438\u0439) \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443!")),W(!0),e((0,m.gw)()),V("")}else B("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u0437\u0430\u043a\u0430\u0437\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437."),W(!0)}catch(t){B("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0438 \u0437\u0430\u043a\u0430\u0437\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0435 \u0440\u0430\u0437."),W(!0)}}},disabled:0===R,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u0437\u0430\u043a\u0430\u0437"})]})]}),N&&(0,g.jsx)(v.zZ,{}),(0,g.jsx)(v.UX,{message:z,isVisible:H,onClose:()=>{W(!1),B("")}}),"Admin"===(null===C||void 0===C?void 0:C.role)&&(0,g.jsx)(f,{isOpen:q,onClose:()=>I(!1)})]}):(0,g.jsx)("div",{className:"employee-page employee-loading",children:(0,g.jsxs)("div",{className:"employee-auth-prompt",children:[(0,g.jsx)("h2",{children:"Loading"}),(0,g.jsx)("p",{children:"Checking authentication..."})]})})}}}]);
//# sourceMappingURL=Employee.a7e0cf9f.chunk.js.map